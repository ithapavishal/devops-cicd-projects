FROM node:latest

LABEL np.com.upside.version="1.0"
# Set build argument
ARG SRC_DIR=/var/node
# Set environment variables
ENV PORT=3000
# Set working directory
WORKDIR $SRC_DIR
# Copy only package.json first for layer caching
# COPY ./weather-app/package.json ./
COPY ./weather-app/package.json "$SRC_DIR"
# Install dependencies
RUN npm install

# Copy the rest of the application
# COPY ./weather-app/ ./
COPY ./weather-app  "$SRC_DIR"

# Use non-root user
USER node
# Expose port
# EXPOSE 3000
EXPOSE "$PORT"

# Start the app
CMD ["node", "./bin/www"]
# CMD ["node", "weather-app/index.js"]
